# sdl-weekly

My study journey of SDL2.

毎日のSDLの学習と成果物をこちらへ置いていきます．
目的はなるべく整理され拡張が容易なゲームをシステムから作ることです．

## なぜSDLを選んだか？

移植性が高く，プラットフォームごとにソースの書き換えが必要となる頻度を抑えられます．また，外部依存性が低いので，システム(エンジン)から自作で作りたいという動機にうまくフィットしました．ボイラープレート(定型的なコード)が増えてしまう懸念点もありますが，なるべく設計で吸収します．

低レイヤの機能も揃っていて，入出力やウィンドウの描画が簡単にできるのも，試しやすいですし，C/C++との相性が良いのも魅力的でした．
基礎から学ぶという目的に合致してます．ただ3Dなど高機能な実装は難しいですが，ひとまず2Dから始めていきます．

DXライブラリやSFMLなども候補にあがりましたが，DXライブラリはWindows向けで私のUbuntu環境に合わず，SFMLも選択肢として非常にありでしたが，SDLのほうが抽象化が低く，低レイヤを触っていきたかったのでSDLで進めていきます．

## week01

### 目的

Create basic classes and functions.

小規模でも拡張性がある，破綻しない2Dゲームの基盤を構築する．重要な点は次のとおり：

- 責務の分離
- RAIIを軸としてリソース管理を徹底する
- 次週(スプライトやシーン管理)を見据えた，SDLの依存範囲を抑えた設計にする

### 設計について

ゲームロジックとSDLへの依存は分離させなければならない．SDLに関わる処理はWindowとRendererへ集約させ，PlayerとGameは極力SDLに依存させない．
また，オブジェクトの寿命をRAIIを軸に明確化して，描画・更新・イベント処理を分けてメインループへ実装する．

上記の方針に沿って，次の4クラスを作成した：

- Window：SDLの初期化/終了とウィンドウの管理．いわゆるキャンバス．アプリの寿命管理を担う．
  - 役割
    - SDL_Init()/SDL_Quit()を管理する
    - SDLのライフサイクル(アプリの開始/終了とWindowの生成)を集約する
    - 責務はWindowの生成と破棄(アプリの開始と終了)
  - 理由
    - Rendererと疎結合にすることで描画処理を任せ，役割を肥大化させない
    - SDLの終了タイミングをここで管理して，他のクラスにライフサイクルを管理させない
    - mainは起動に集中させ依存を分散させない
- Renderer：描画処理を担う．いわゆる筆
  - 役割
    - Windowはあくまで描画する場所であり，描画処理をRendererが担う
    - GameやPlayerをSDLと描画に依存させない
  - 理由
    - Windowは描画する場所であり，Rendererは描画するための窓口
    - 描画処理を一元管理させて，後々のスプライト処理などの実装に備える
    - 役割の関係性から，オブジェクトの関係は次のようになる
      - Window生成→Rendererの生成，Rendererの破棄→Windowの破棄の順番
- Player：座標や動作，更新など．とりあえず矩形がプレイヤー
  - 役割
    - Playerの状態(座標・速度など)を管理する
    - 描画の責務はRendererへ委譲する
    - 描画可能な位置，サイズなどを返す
  - 理由
    - Playerは毎フレームRendererへ状態を渡すことで，状態の変化と描画が一致する
    - Rendererとの責務の境界を明確にした
- Game：ゲームの処理をまとめる部分．ループ処理と呼び出しがメイン
  - 役割
    - メインループ，イベント処理，更新処理，ゲーム全体の状態管理
    - main.cppは起動や引数の責務を負っているため，ゲームにまつわる状態遷移を分離させた
    - SDLのイベントやフレームごとの処理などを実施
  - 理由
    - ゲームの処理やループを一元管理させて，他のオブジェクトに破綻が伝搬しないようにする

### 成果

- RAIIを意識したWindowとRendererを作成
- SDLになるべく依存しないPlayer/Gameの実装
- ゲームループを作成

## week02

### 設計について

SpriteとTextureを追加．ただし，Rendererとの参照関係は明確にして，循環参照にならないように注意する．
現状の関係は次の通り：

- Texture  ---依存---> SDL_Texture*
- Sprite   ---依存---> Texture（参照）
- Player   ---依存---> Sprite
- Renderer ---依存---> SDL_Renderer*
- Game     ---依存---> Texture / Player / Renderer

TextureはRendererに依存してはならない．

## アセット

- Red Hat Boy
